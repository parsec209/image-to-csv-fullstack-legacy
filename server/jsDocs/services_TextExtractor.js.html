<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: services/textExtractor.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: services/textExtractor.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * textExtractor module
 * @module textExtractor
 */

//This module borrows and modifies parts of the code sample found at https://github.com/googleapis/nodejs-vision/blob/master/samples/batch-annotate-files-gcs.js 

const { validateArgs, schemas } = require('../util/argsValidator')
const { ImageAnnotatorClient } = require('@google-cloud/vision').v1
const client = new ImageAnnotatorClient()
const path = require('path')
const Joi = require('joi')


// @ts-check

 
/**
 * Extract text from document using GCP Vision image annotation
 * @param {CloudFile} doc - Doc file from GCP storage bucket
 * @param {Array&lt;number>} pageSelections - Page numbers to scan for this file batch
 * @returns {Promise&lt;DocText>} - Object containing document text annotations and original filename 
 * @throws {Error} - Operational error when none of the page selections matches an actual doc page in the batch
 */
const getDocText = async function(doc, pageSelections) {
  validateArgs(arguments, { 0: Joi.object(), 1: schemas.pageSelections })
  const inputConfig = {
    // Supported mime_type: application/pdf, image/tiff, image/gif
    mimeType: doc.metadata.contentType,
    gcsSource: {
      uri: `gs://${process.env.STORAGE_BUCKET}/${doc.name}`
    },
  }
  const features = [{type: 'DOCUMENT_TEXT_DETECTION'}]
  const fileRequest = {
    inputConfig,
    features,
    // First page starts at 1, last page starts at -1
    pages: pageSelections,
    imageContext: { 
      // English encoding is specified, since some text within docs such as invoices (i.e. invoice numbers) can be confused as another language
      languageHints: ['en'],
    }
  }
  const request = {
    requests: [fileRequest]
  }
  const [result] = await client.batchAnnotateFiles(request)
  const docText = result.responses[0].responses
  return { fileName: path.basename(doc.name), extraction: docText }
}


module.exports = getDocText</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Img-To-CSV Services</a></h2><h3>Modules</h3><ul><li><a href="module-cellValueGenerator.html">cellValueGenerator</a></li><li><a href="module-CSVGenerator.html">CSVGenerator</a></li><li><a href="module-CSVWriter.html">CSVWriter</a></li><li><a href="module-passwordReset.html">passwordReset</a></li><li><a href="module-postService.html">postService</a></li><li><a href="module-textExtractor.html">textExtractor</a></li><li><a href="module-uploader.html">uploader</a></li><li><a href="module-wordListGenerator.html">wordListGenerator</a></li><li><a href="module-zipWriter.html">zipWriter</a></li></ul><h3>Classes</h3><ul><li><a href="InputError.html">InputError</a></li><li><a href="module-cellValueGenerator-CellValueGenerator.html">CellValueGenerator</a></li><li><a href="module-postService-PostService.html">PostService</a></li><li><a href="module-uploader-Uploader.html">Uploader</a></li><li><a href="module-zipWriter-ZipWriter.html">ZipWriter</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Thu Sep 30 2021 21:01:25 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
